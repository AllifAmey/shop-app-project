import{M as S,r as d,ar as I,as as _,j as e,F as x,o as P,G as t,f as l,B as k,L as p}from"./index-6ebe7ac4.js";import{C as N}from"./CircularProgress-5956a5f6.js";import{T as f}from"./TextField-3e7c6e2c.js";import"./useFormControl-b0644f7e.js";async function b(n,u,c){n(!0);let i=await fetch(`${S}/api/user/token/`,{method:"POST",body:JSON.stringify({email:u,password:c}),headers:{"Content-type":"application/json"}});if(i.ok){let s=await i.json();return localStorage.setItem("Token",s.token),localStorage.setItem("isLogged","LOGGED_IN"),i=await fetch(`${S}/api/user/me/`,{method:"GET",headers:{"Content-type":"application/json",Authorization:`Token ${s.token}`}}),i.ok?(s=await i.json(),n(!1),s):(n(!1),"error")}else return n(!1),"error"}async function D(n,u,c,i){n(!0);const m=await(await fetch(`${S}/api/user/create/`,{method:"POST",body:JSON.stringify({name:u,email:c,password:i}),headers:{"Content-type":"application/json"}})).json();console.log(m),n(!1)}function L(n){return n.split("_").map(i=>i[0].toUpperCase()+i.substring(1)).join(" ")}function A(n){const[u,c]=d.useState(""),[i,s]=d.useState(""),[m,v]=d.useState(""),[C,h]=d.useState(!1),w=I(),j=_(),r=L(j.accessType),y=async o=>{if(o.preventDefault(),r==="Login"){const a=await b(h,i,m);if(a!=="error"){a.user_status==="member"?localStorage.setItem("username",a.name):a.user_status==="staff"&&localStorage.setItem("username",a.email);const g=localStorage.getItem("username");localStorage.setItem("user_id",a.user_id),localStorage.setItem("user_status",a.user_status),w(`/account/${a.user_status}/${g}`)}}else if(r==="Sign Up"){await D(h,u,i,m);const a=await b(h,i,m);a.user_status==="member"?localStorage.setItem("username",a.name):a.user_status==="staff"&&localStorage.setItem("username",a.email);const g=localStorage.getItem("username");localStorage.setItem("user_id",a.user_id),localStorage.setItem("user_status",a.user_status),w(`/account/${a.user_status}/${g}`)}};return e(x,{children:C?e(N,{size:"25rem",sx:{margin:"auto"}}):e(P,{height:"auto",width:1,children:e("form",{noValidate:!0,autoComplete:"off",onSubmit:y,children:e(t,{container:!0,justifyContent:"center",alignItems:"center",height:"100vh",width:.8,margin:"0 auto",children:l(t,{item:!0,container:!0,flexDirection:"column",justifyContent:"start",width:.5,height:1,children:[l(t,{item:!0,container:!0,flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",height:.3,children:[e(t,{item:!0,fontSize:44,children:"SahrahJewellery"}),e(t,{item:!0,fontSize:30,fontWeight:800,children:r})]}),l(t,{item:!0,container:!0,flexDirection:"column",alignItems:"center",justifyContent:"space-evenly",padding:"1rem",height:.6,children:[r==="Sign Up"&&l(t,{item:!0,container:!0,flexDirection:"column",justifyContent:"space-evenly",alignItems:"start",width:.8,gap:2,children:[e(t,{item:!0,children:"Name"}),e(t,{item:!0,width:1,children:e(f,{fullWidth:!0,id:"outlined-basic",label:"Name",variant:"outlined",size:"big",onChange:o=>{c(o.target.value)},required:!0,inputProps:{"aria-label":"Name"}})})]}),l(t,{item:!0,container:!0,flexDirection:"column",justifyContent:"space-evenly",alignItems:"start",width:.8,gap:2,children:[e(t,{item:!0,children:"Email Address"}),e(t,{item:!0,width:1,children:e(f,{fullWidth:!0,id:"outlined-basic",label:"Email",variant:"outlined",size:"big",inputProps:{"aria-label":"Email"},onChange:o=>{s(o.target.value)},required:!0})})]}),["Login","Sign Up"].includes(r)&&l(t,{item:!0,container:!0,flexDirection:"column",justifyContent:"space-evenly",alignItems:"start",width:.8,gap:2,children:[e(t,{item:!0,textAlign:"start",children:"Password"}),e(t,{item:!0,width:1,children:e(f,{fullWidth:!0,id:"outlined-basic",label:"Password",variant:"outlined",size:"big",inputProps:{"aria-label":"Password"},onChange:o=>{v(o.target.value)},required:!0})})]}),e(t,{item:!0,width:.5,children:e(k,{variant:"outlined",size:"big",fullWidth:!0,onClick:y,"aria-label":r,children:r})}),r==="Login"?l(t,{item:!0,container:!0,justifyContent:"space-evenly",children:[e(t,{item:!0,component:p,to:"/account/sign_up","aria-label":"Link to sign up to shop",children:"Don't have account?"}),e(t,{item:!0,component:p,to:"/account/recover","aria-label":"Link to recover account by email",children:"Forgot password?"})]}):e(t,{item:!0,component:p,to:"/account/login","aria-label":"Link to Log in to shop",children:"Have an account?"})]})]})})})})})}export{A as default};
