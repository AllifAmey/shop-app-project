import{j as e,y as V,b as v,z as B,r as o,aj as H,x as J,D as L,F as K,G as c,I as j,N as U,B as b,L as X}from"./index-fb1067bf.js";import{B as Y,a as P,d as Z,b as ee,D as te,N as ae,m as re}from"./MassDeleteAPI-83fcb04e.js";import{g as ne}from"./OrderAPI-87c673a1.js";import"./ListItemText-ded7936e.js";import"./LastPage-5af58c1b.js";import"./SwitchBase-e22c3396.js";function ie(t){function d(u){u==0?B(t.setIsLoading).then(s=>{t.setIsLoading(!0);let n=[];for(const[i,r]of Object.entries(s)){const C=i.slice(i.lastIndexOf(" ")+1,i.length),y=Number(r.product.price),h=Number(r.quantity),S=(y*h).toFixed(2);n.push({id:C,product:r.product.name,quantity:h,totalPrice:S})}t.setrowValue(n),t.setIsLoading(!1)}):u==1&&(t.setIsLoading(!0),ne(t.setIsLoading).then(s=>{let n=[],i=[];s.forEach(r=>{n.push({id:r.id,view:"Click me!",totalPrice:r.total_price,deliveryStatus:r.delivery_status}),i.push(r)}),t.setrowValue(n),t.setOrderRowDetail(i),t.setIsLoading(!1)}))}return e(V,{sx:{width:500},children:v(Y,{showLabels:!0,value:t.navValue,onChange:(u,s)=>{d(s),t.setNavValue(s)},children:[e(P,{label:"Cart",icon:e(Z,{})}),e(P,{label:"Orders",icon:e(ee,{})})]})})}function he(t){const[d,u]=o.useState(0),[s,n]=o.useState(!1),[i,r]=o.useState(),[C,y]=o.useState([]),[h,S]=o.useState(),[R,q]=o.useState(!1),[N,_]=o.useState(!1),[O,I]=o.useState(!1),z=()=>{I(!0)},F=()=>{I(!1)},E=H(),D=J(),G=[{field:"id",headerName:"ID",width:70},{field:"view",headerName:"View Order",renderCell:a=>e("strong",{children:e(b,{variant:"contained",size:"small",style:{marginLeft:16},tabIndex:a.hasFocus?0:-1,onClick:()=>{S(a.id),z()},children:"Open"})}),width:120},{field:"totalPrice",headerName:"Total Price",type:"number",width:150},{field:"deliveryStatus",headerName:"Delivery Status",width:150}],A=[{field:"id",headerName:"ID",width:70},{field:"product",headerName:"Product",width:90},{field:"quantity",headerName:"Quantity",width:90},{field:"totalPrice",headerName:"Total Price",type:"number",width:150}];o.useEffect(()=>{let a=localStorage.getItem("username");a!=null&&E(`/account/${a}/`,{replace:!0}),B(n).then(l=>{n(!0);let m=[],f=[];for(const[g,w]of Object.entries(l)){const x=g.slice(g.lastIndexOf(" ")+1,g.length),W=`card${w.product.id}`,Q=Number(w.product.price),p=Number(w.quantity),k=(Q*p).toFixed(2);m.push({key:W,...w.product,quantity:p,price:k,data_id:x}),f.push({id:x,product:w.product.name,quantity:p,totalPrice:k})}D(L.replaceCart(m)),r(f),n(!1)})},[]);function T(){const a=[...C],l=i;let m=[...i],f=0;D(L.changeItem(["delete",a])),l.forEach(g=>{a.includes(g.id)&&m.splice(f,1),f++}),r(m),re(n,"cart",a)}function $(){localStorage.removeItem("Token"),localStorage.removeItem("username"),localStorage.removeItem("isLogged"),localStorage.removeItem("user_id"),localStorage.removeItem("user_status"),t.logOut(!1)}function M(a){return a.id==h}return v(K,{children:[s?e(c,{container:!0,justifyContent:"center",children:e(j,{size:"25rem",sx:{margin:"auto"}})}):i==null?e(c,{container:!0,justifyContent:"center",children:e(j,{size:"25rem",sx:{margin:"auto"}})}):e(V,{height:"100vh",children:e(U,{maxWidth:"lg",children:v(c,{padding:"2rem 0",container:!0,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:2,children:[v(c,{item:!0,justifyContent:"center",children:["Welcome back, ",localStorage.getItem("username")]}),e(c,{item:!0,container:!0,justifyContent:"center",children:e(ie,{setIsLoading:n,setrowValue:r,setNavValue:u,navValue:d,setOrderRowDetail:q})}),e(c,{item:!0,container:!0,justifyContent:"center",width:"75vw",children:e("div",{style:{height:400,width:"60%"},children:e(te,{rows:i,columns:d==0?A:G,pageSize:5,rowsPerPageOptions:[5],checkboxSelection:!0,disableSelectionOnClick:!0,disableColumnSelector:!0,onSelectionModelChange:a=>{const l=new Set(a);y(l),[...l].length==0?_(!1):_(!0)}})})}),v(c,{item:!0,container:!0,justifyContent:N?"space-between":"center",width:.2,height:.5,children:[N&&e(b,{variant:"contained",sx:{color:"red"},onClick:T,children:"Delete items"}),e(b,{variant:"contained",component:X,to:"/account/login",onClick:$,children:"Log out"})]})]})})}),d==1&&e(ae,{open:O,setOpen:I,handleClose:F,rowDetail:O&&R.filter(M),checkOrderId:h})]})}export{he as default};
